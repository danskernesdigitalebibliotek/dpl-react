"use strict";(globalThis.webpackChunk_danskernesdigitalebibliotek_dpl_react=globalThis.webpackChunk_danskernesdigitalebibliotek_dpl_react||[]).push([[5468],{"./src/apps/reservation-list/modal/reservation-details/reservation-details.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>reservation_details});var react=__webpack_require__("./node_modules/react/index.js"),reservation_type=__webpack_require__("./src/core/utils/types/reservation-type.ts"),material_fetch_hoc=__webpack_require__("./src/apps/loan-list/materials/utils/material-fetch-hoc.tsx"),modal_details_header=__webpack_require__("./src/components/modal-details-header/modal-details-header.tsx"),Reservations=__webpack_require__("./node_modules/@danskernesdigitalebibliotek/dpl-design-system/build/icons/collection/Reservations.svg"),Reservations_default=__webpack_require__.n(Reservations),Loans=__webpack_require__("./node_modules/@danskernesdigitalebibliotek/dpl-design-system/build/icons/collection/Loans.svg"),Loans_default=__webpack_require__.n(Loans),utils_text=__webpack_require__("./src/core/utils/text.tsx"),list_details=__webpack_require__("./src/components/list-details/list-details.tsx"),date=__webpack_require__("./src/core/utils/helpers/date.ts");const digital_list_details=({reservation})=>{const t=(0,utils_text.F)(),{expiryDate,dateOfReservation,pickupDeadline,state}=reservation;return react.createElement(react.Fragment,null,expiryDate&&"readyForPickup"===state&&react.createElement(list_details.A,{icon:Reservations_default(),title:t("reservationDetailsStatusTitleText"),labels:t("reservationDetailsExpiresText",{placeholders:{"@date":(0,date.r6)(expiryDate)}})}),pickupDeadline&&"reserved"===state&&react.createElement(list_details.A,{icon:Reservations_default(),title:t("reservationDetailsStatusTitleText"),labels:t("reservationDetailsBorrowBeforeText",{placeholders:{"@date":(0,date.r6)(pickupDeadline)}})}),dateOfReservation&&react.createElement(list_details.A,{icon:Loans_default(),labels:(0,date.r6)(dateOfReservation),title:t("reservationDetailsDateOfReservationTitleText")}))};try{digitallistdetails.displayName="digitallistdetails",digitallistdetails.__docgenInfo={description:"",displayName:"digitallistdetails",props:{reservation:{defaultValue:null,description:"",name:"reservation",required:!0,type:{name:"Nullable<Partial<Reservation>>"}},material:{defaultValue:null,description:"",name:"material",required:!1,type:{name:"Nullable<Partial<BasicDetails>> | null | undefined"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/apps/reservation-list/modal/reservation-details/digital-list-details.tsx#digitallistdetails"]={docgenInfo:digitallistdetails.__docgenInfo,name:"digitallistdetails",path:"src/apps/reservation-list/modal/reservation-details/digital-list-details.tsx#digitallistdetails"})}catch(__react_docgen_typescript_loader_error){}var Button=__webpack_require__("./src/components/Buttons/Button.tsx");const reservation_details_buttons=({openReservationDeleteModal,classNames,buttonClassNames,reservation})=>{const t=(0,utils_text.F)();return react.createElement("div",{className:`modal-details__buttons ${classNames}`},react.createElement(Button.$,{label:t("reservationDetailsButtonRemoveText"),onClick:()=>openReservationDeleteModal(reservation),classNames:buttonClassNames,buttonType:"none",disabled:!1,collapsible:!1,size:"small",variant:"filled"}))};try{reservationdetailsbuttons.displayName="reservationdetailsbuttons",reservationdetailsbuttons.__docgenInfo={description:"",displayName:"reservationdetailsbuttons",props:{reservation:{defaultValue:null,description:"",name:"reservation",required:!0,type:{name:"Nullable<Partial<Reservation>>"}},classNames:{defaultValue:null,description:"",name:"classNames",required:!1,type:{name:"string | undefined"}},buttonClassNames:{defaultValue:null,description:"",name:"buttonClassNames",required:!1,type:{name:"string | undefined"}},openReservationDeleteModal:{defaultValue:null,description:"",name:"openReservationDeleteModal",required:!0,type:{name:"(deleteReservation: Nullable<Partial<Reservation>>) => void"}},material:{defaultValue:null,description:"",name:"material",required:!1,type:{name:"Nullable<Partial<BasicDetails>> | null | undefined"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/apps/reservation-list/modal/reservation-details/reservation-details-buttons.tsx#reservationdetailsbuttons"]={docgenInfo:reservationdetailsbuttons.__docgenInfo,name:"reservationdetailsbuttons",path:"src/apps/reservation-list/modal/reservation-details/reservation-details-buttons.tsx#reservationdetailsbuttons"})}catch(__react_docgen_typescript_loader_error){}var LinkButton=__webpack_require__("./src/components/Buttons/LinkButton.tsx");const reservation_details_redirect=({reservation,openReservationDeleteModal,className,linkClassNames,workUrl})=>{const t=(0,utils_text.F)();return react.createElement("div",{className:`modal-details__buttons ${className}`},react.createElement(Button.$,{buttonType:"none",label:t("reservationDetailsRemoveDigitalReservationText"),size:"small",variant:"outline",collapsible:!1,disabled:!1,onClick:()=>openReservationDeleteModal(reservation),classNames:linkClassNames,dataCy:"remove-digital-reservation-button"}),react.createElement(LinkButton.A,{dataCy:"view-material-button",size:"small",url:workUrl,variant:"filled",id:"view-material-button",iconClassNames:"btn-icon invert"},t("viewMaterialText")))};try{reservationdetailsredirect.displayName="reservationdetailsredirect",reservationdetailsredirect.__docgenInfo={description:"",displayName:"reservationdetailsredirect",props:{reservation:{defaultValue:null,description:"",name:"reservation",required:!0,type:{name:"Nullable<Partial<Reservation>>"}},openReservationDeleteModal:{defaultValue:null,description:"",name:"openReservationDeleteModal",required:!0,type:{name:"(deleteReservation: Nullable<Partial<Reservation>>) => void"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string | undefined"}},linkClassNames:{defaultValue:null,description:"",name:"linkClassNames",required:!1,type:{name:"string | undefined"}},workUrl:{defaultValue:null,description:"",name:"workUrl",required:!0,type:{name:"URL"}},material:{defaultValue:null,description:"",name:"material",required:!1,type:{name:"Nullable<Partial<BasicDetails>> | null | undefined"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/apps/reservation-list/modal/reservation-details/reservation-details-redirect.tsx#reservationdetailsredirect"]={docgenInfo:reservationdetailsredirect.__docgenInfo,name:"reservationdetailsredirect",path:"src/apps/reservation-list/modal/reservation-details/reservation-details-redirect.tsx#reservationdetailsredirect"})}catch(__react_docgen_typescript_loader_error){}var digital_material_fetch_hoc=__webpack_require__("./src/apps/loan-list/materials/utils/digital-material-fetch-hoc.tsx"),Ebook=__webpack_require__("./node_modules/@danskernesdigitalebibliotek/dpl-design-system/build/icons/collection/Ebook.svg"),Ebook_default=__webpack_require__.n(Ebook),Location=__webpack_require__("./node_modules/@danskernesdigitalebibliotek/dpl-design-system/build/icons/collection/Location.svg"),Location_default=__webpack_require__.n(Location),LoanHistory=__webpack_require__("./node_modules/@danskernesdigitalebibliotek/dpl-design-system/build/icons/collection/LoanHistory.svg"),LoanHistory_default=__webpack_require__.n(LoanHistory),es=__webpack_require__("./node_modules/react-query/es/index.js"),fbs=__webpack_require__("./src/core/fbs/fbs.ts"),helper=__webpack_require__("./src/components/reservation/helper.ts"),utils_config=__webpack_require__("./src/core/utils/config.tsx"),PickupModal=__webpack_require__("./src/components/reservation/forms/PickupModal.tsx"),modal=__webpack_require__("./src/core/utils/modal.tsx"),forms_helper=__webpack_require__("./src/components/reservation/forms/helper.ts"),utils_branches=__webpack_require__("./src/core/utils/branches.tsx"),ReservationFormListItem=__webpack_require__("./src/components/reservation/ReservationFormListItem.tsx"),NoInterestAfterModal=__webpack_require__("./src/components/reservation/forms/NoInterestAfterModal.tsx"),helpers=__webpack_require__("./src/apps/reservation-list/utils/helpers.ts");const physical_list_details=({reservation,reservation:{numberInQueue,pickupBranch,expiryDate,pickupDeadline,dateOfReservation,pickupNumber,reservationIds}})=>{const config=(0,utils_config.UK)(),t=(0,utils_text.F)(),{open}=(0,modal.X)(),queryClient=(0,es.useQueryClient)(),{mutate}=(0,fbs.cK)(),interestPeriods=config("interestPeriodsConfig",{transformer:"jsonParse"}),[selectedInterest,setSelectedInterest]=(0,react.useState)(null),[selectedBranch,setSelectedBranch]=(0,react.useState)(pickupBranch),[reservationStatus,setReservationStatus]=(0,react.useState)("idle"),openModal=type=>()=>{open((0,forms_helper.zW)(type))},branches=config("branchesConfig",{transformer:"jsonParse"}),blacklistBranches=config("blacklistedPickupBranchesConfig",{transformer:"stringToArray"}),whitelistBranches=(0,utils_branches.z5)(branches,blacklistBranches),isReadyForPickup=(0,helpers.JU)([reservation]).length>0,saveChanges=formSelectValue=>{if(setReservationStatus("pending"),!reservationIds||0===reservationIds.length||!selectedBranch)return console.error("Missing reservationId or selectedBranch"),void setReservationStatus("error");const reservationsChanges=(({formSelectValue,reservationIds,expiryDate,selectedBranch})=>{const getSelectedPickupBranch=value=>"string"==typeof value?value:selectedBranch;return reservationIds.map((reservationId=>{return{expiryDate:(value=formSelectValue,"number"==typeof value?(0,date.ZI)(value):expiryDate??""),pickupBranch:getSelectedPickupBranch(formSelectValue),reservationId};var value}))})({formSelectValue,reservationIds,expiryDate,selectedBranch});mutate({data:{reservations:reservationsChanges}},{onSuccess:()=>{setReservationStatus("success"),queryClient.invalidateQueries((0,fbs.vN)())},onError:()=>{setReservationStatus("error")}})};return react.createElement(react.Fragment,null,numberInQueue&&react.createElement(list_details.A,{icon:Ebook_default(),title:t("reservationDetailsStatusTitleText"),labels:[t("reservationDetailsNumberInQueueLabelText",{placeholders:{"@count":numberInQueue}})]}),pickupBranch&&react.createElement(react.Fragment,null,react.createElement(ReservationFormListItem.A,{icon:Location_default(),title:t("reservationDetailsPickUpAtTitleText"),text:(0,helper.C4)(selectedBranch??pickupBranch,whitelistBranches),changeHandler:openModal("pickup"),buttonAriaLabel:t("changePickupLocationText"),subText:pickupNumber??"",isPossibleToChangeReservationDetails:!isReadyForPickup}),!isReadyForPickup&&react.createElement(PickupModal.A,{branches:whitelistBranches,defaultBranch:pickupBranch,selectBranchHandler:setSelectedBranch,saveCallback:saveChanges,reservationStatus,setReservationStatus})),expiryDate&&react.createElement(react.Fragment,null,react.createElement(ReservationFormListItem.A,{icon:LoanHistory_default(),title:t("reservationDetailsNoInterestAfterTitleText"),text:selectedInterest?(0,date.Yq)((0,date.ZI)(selectedInterest)):(0,date.Yq)(expiryDate),changeHandler:openModal("interestPeriod"),buttonAriaLabel:t("changeInterestPeriodText"),isPossibleToChangeReservationDetails:!isReadyForPickup}),!isReadyForPickup&&react.createElement(NoInterestAfterModal.A,{selectedInterest:selectedInterest??Number(interestPeriods.defaultInterestPeriod.value),setSelectedInterest,saveCallback:saveChanges,reservationStatus,setReservationStatus})),pickupDeadline&&react.createElement(list_details.A,{icon:Reservations_default(),title:t("reservationDetailsPickupDeadlineTitleText"),labels:[(0,date.Yq)(pickupDeadline)]}),dateOfReservation&&react.createElement(list_details.A,{icon:Loans_default(),title:t("reservationDetailsDateOfReservationTitleText"),labels:[(0,date.Yq)(dateOfReservation)]}))};try{physicallistdetails.displayName="physicallistdetails",physicallistdetails.__docgenInfo={description:"",displayName:"physicallistdetails",props:{reservation:{defaultValue:null,description:"",name:"reservation",required:!0,type:{name:"Nullable<Partial<Reservation>>"}},material:{defaultValue:null,description:"",name:"material",required:!1,type:{name:"Nullable<Partial<BasicDetails>> | null | undefined"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/apps/reservation-list/modal/reservation-details/physical-list-details.tsx#physicallistdetails"]={docgenInfo:physicallistdetails.__docgenInfo,name:"physicallistdetails",path:"src/apps/reservation-list/modal/reservation-details/physical-list-details.tsx#physicallistdetails"})}catch(__react_docgen_typescript_loader_error){}var MaterialButtonLoading=__webpack_require__("./src/components/material/material-buttons/generic/MaterialButtonLoading.tsx"),useGetWorkUrlFromPublizonIdentifier=__webpack_require__("./src/core/utils/useGetWorkUrlFromPublizonIdentifier.ts");const reservation_details=(0,digital_material_fetch_hoc.A)((0,material_fetch_hoc.A)((({reservation,material,openReservationDeleteModal})=>{const t=(0,utils_text.F)(),config=(0,utils_config.UK)(),{state,identifier}=reservation,{authors,pid,year,title,description,materialType}=material||{},{allowRemoveReadyReservations}=config("reservationDetailsConfig",{transformer:"jsonParse"}),allowUserRemoveReadyReservations="readyForPickup"===state&&allowRemoveReadyReservations||"readyForPickup"!==state,{workUrl,isLoading}=(0,useGetWorkUrlFromPublizonIdentifier.A)(identifier);return react.createElement("div",{className:"modal-details__container"},material&&react.createElement(react.Fragment,null,react.createElement(modal_details_header.A,{isbnForCover:identifier||"",authors,year,title,pid,description,materialType,series:material.series},"readyForPickup"===state&&react.createElement("div",{className:"status-label status-label--info"},t("reservationDetailsReadyForLoanText"))),(0,reservation_type.uT)(reservation)&&allowUserRemoveReadyReservations&&react.createElement(reservation_details_buttons,{classNames:"modal-details__buttons--hide-on-mobile",openReservationDeleteModal,reservation}),(0,reservation_type.BP)(reservation)&&isLoading&&react.createElement("div",{className:"modal-details__buttons modal-details__buttons--hide-on-mobile"},react.createElement(MaterialButtonLoading.A,{classNames:"modal-details__buttons--hide-on-mobile"})),(0,reservation_type.BP)(reservation)&&!isLoading&&workUrl&&react.createElement(reservation_details_redirect,{openReservationDeleteModal,reservation,className:"modal-details__buttons--hide-on-mobile",linkClassNames:"mx-16",workUrl}),react.createElement("div",{className:"modal-details__list"},(0,reservation_type.BP)(reservation)&&react.createElement(digital_list_details,{reservation}),(0,reservation_type.uT)(reservation)&&react.createElement(physical_list_details,{reservation})),(0,reservation_type.uT)(reservation)&&allowUserRemoveReadyReservations&&react.createElement(reservation_details_buttons,{buttonClassNames:"modal-details__buttons__full-width",openReservationDeleteModal,reservation}),(0,reservation_type.BP)(reservation)&&!isLoading&&workUrl&&react.createElement(reservation_details_redirect,{openReservationDeleteModal,linkClassNames:"my-16",reservation,workUrl})))})));try{reservationdetails.displayName="reservationdetails",reservationdetails.__docgenInfo={description:"",displayName:"reservationdetails",props:{reservation:{defaultValue:null,description:"",name:"reservation",required:!0,type:{name:"Nullable<Partial<Reservation>>"}},openReservationDeleteModal:{defaultValue:null,description:"",name:"openReservationDeleteModal",required:!0,type:{name:"(deleteReservation: Nullable<Partial<Reservation>>) => void"}},digitalMaterial:{defaultValue:null,description:"",name:"digitalMaterial",required:!1,type:{name:"Product | null | undefined"}},item:{defaultValue:null,description:"",name:"item",required:!1,type:{name:"Nullable<Partial<ListIdsType & { details: Nullable<Partial<BasicDetails>>; }>>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/apps/reservation-list/modal/reservation-details/reservation-details.tsx#reservationdetails"]={docgenInfo:reservationdetails.__docgenInfo,name:"reservationdetails",path:"src/apps/reservation-list/modal/reservation-details/reservation-details.tsx#reservationdetails"})}catch(__react_docgen_typescript_loader_error){}},"./src/core/utils/useReservations.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>utils_useReservations});var publizon=__webpack_require__("./src/core/publizon/publizon.ts"),list_mapper=__webpack_require__("./src/core/utils/helpers/list-mapper.ts"),helpers=__webpack_require__("./src/apps/reservation-list/utils/helpers.ts");const{dashboardReadyForPickupApiValueText,dashboardReservedApiValueText}={dashboardReadyForPickupApiValueText:"readyForPickup",dashboardReservedApiValueText:"reserved"};var reduce=__webpack_require__("./node_modules/lodash/reduce.js"),reduce_default=__webpack_require__.n(reduce),min=__webpack_require__("./node_modules/lodash/min.js"),min_default=__webpack_require__.n(min),map=__webpack_require__("./node_modules/lodash/map.js"),map_default=__webpack_require__.n(map),groupBy=__webpack_require__("./node_modules/lodash/groupBy.js"),groupBy_default=__webpack_require__.n(groupBy),fbs=__webpack_require__("./src/core/fbs/fbs.ts");function groupReservations(data){const reservationGroups=groupBy_default()(data,(reservation=>"parallel"===reservation.reservationType?reservation.transactionId:reservation.reservationId));return map_default()(reservationGroups,(reservationGroup=>({...reservationGroup[0],numberInQueue:min_default()(map_default()(reservationGroup,"numberInQueue")),records:reduce_default()(reservationGroup,((result,reservation)=>({...result,[reservation.recordId]:reservation.reservationId})),{})})))}const utils_useGetReservationGroups=()=>{const result=(0,fbs.$6)();return{...result,data:result.data&&Array.isArray(result.data)?groupReservations(result.data):null}};const getQueuedReservations=list=>[...list].filter((({state})=>state===dashboardReservedApiValueText)),utils_useReservations=()=>{const{data:reservationsFbs,isLoading:isLoadingFbs,isError:isErrorFbs}=utils_useGetReservationGroups(),{data:reservationsPublizon,isLoading:isLoadingPublizon,isError:isErrorPublizon}=(0,publizon.pA)(),reservationsIsLoading=isLoadingFbs||isLoadingPublizon,reservationsIsError=isErrorFbs||isErrorPublizon,mappedReservationsFbs=reservationsFbs?(0,list_mapper.sl)(reservationsFbs):[],mappedReservationsPublizon=null!=reservationsPublizon&&reservationsPublizon.reservations?(0,list_mapper.hg)(reservationsPublizon.reservations):[],reservations=[...mappedReservationsFbs,...mappedReservationsPublizon],reservationsReadyToLoanFBS=(0,helpers.JU)(mappedReservationsFbs),reservationsReadyToLoanPublizon=(0,helpers.JU)(mappedReservationsPublizon),reservationsReadyToLoan=[...reservationsReadyToLoanFBS,...reservationsReadyToLoanPublizon],reservationsQueuedFBS=getQueuedReservations(mappedReservationsFbs),reservationsQueuedPublizon=getQueuedReservations(mappedReservationsPublizon);return{all:{reservations,readyToLoan:reservationsReadyToLoan,queued:[...reservationsQueuedFBS,...reservationsQueuedPublizon],isLoading:reservationsIsLoading,isError:reservationsIsError},fbs:{reservations:mappedReservationsFbs,readyToLoan:reservationsReadyToLoanFBS,queued:reservationsQueuedFBS,isLoading:isLoadingFbs,isError:isErrorFbs},publizon:{reservations:mappedReservationsPublizon,readyToLoan:reservationsReadyToLoanPublizon,queued:reservationsQueuedPublizon,isLoading:isLoadingPublizon,isError:isErrorPublizon}}}}}]);