"use strict";(globalThis.webpackChunk_danskernesdigitalebibliotek_dpl_react=globalThis.webpackChunk_danskernesdigitalebibliotek_dpl_react||[]).push([[2649],{"./src/core/publizon/mutator/PublizonServiceError.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>PublizonServiceError});var _fetchers_FetcherHttpError__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/core/fetchers/FetcherHttpError.ts");function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}class PublizonServiceError extends _fetchers_FetcherHttpError__WEBPACK_IMPORTED_MODULE_0__.A{constructor(status,message,responseBody,context){super(status,message,context),_defineProperty(this,"name","PublizonServiceError"),_defineProperty(this,"responseBody",void 0),this.responseBody=responseBody}}},"./src/core/publizon/publizon.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{qC:()=>getGetV1LoanstatusIdentifierQueryKey,BE:()=>getGetV1UserLoansQueryKey,tt:()=>getGetV1UserReservationsQueryKey,de:()=>useDeleteV1UserReservationsIdentifier,PF:()=>useGetV1LibraryProfile,Qo:()=>useGetV1LoanstatusIdentifier,wK:()=>useGetV1ProductsIdentifier,cC:()=>useGetV1UserCardnumberFriendly,VM:()=>useGetV1UserLoans,pA:()=>useGetV1UserReservations,I5:()=>usePostV1UserLoansIdentifier,st:()=>usePostV1UserReservationsIdentifier});var es=__webpack_require__("./node_modules/react-query/es/index.js"),FetchFailedCriticalError=__webpack_require__("./src/core/fetchers/FetchFailedCriticalError.ts"),helpers=__webpack_require__("./src/core/fetchers/helpers.ts"),core_token=__webpack_require__("./src/core/token.js"),extractServiceBaseUrls=__webpack_require__("./src/core/utils/reduxMiddleware/extractServiceBaseUrls.ts"),PublizonServiceError=__webpack_require__("./src/core/publizon/mutator/PublizonServiceError.ts");const fetcher_fetcher=async({url,method,headers,params,data})=>{const token=(0,core_token.gf)(core_token.CI)??(0,core_token.gf)(core_token._L),authHeaders=token?{Authorization:`Bearer ${token}`}:{},body=data?JSON.stringify(data):null,serviceUrl=(0,helpers.Z4)({baseUrl:(0,extractServiceBaseUrls.aW)(extractServiceBaseUrls.TJ.publizon),url,params});try{const response=await fetch(serviceUrl,{method,headers:{...headers,...authHeaders},body});try{const responseBody=await response.json();if(!response.ok)throw new PublizonServiceError.A(response.status,response.statusText,responseBody,serviceUrl);return responseBody??null}catch(e){if(!(e instanceof SyntaxError))throw e}}catch(error){if(error instanceof PublizonServiceError.A)throw error;const message=error instanceof Error?error.message:"Unknown error";throw new FetchFailedCriticalError.A(message,serviceUrl)}return null},getGetV1UserCardnumberFriendlyQueryOptions=options=>{const{query:queryOptions}=options??{};return{queryKey:(null==queryOptions?void 0:queryOptions.queryKey)??["/v1/user/cardnumber/friendly"],queryFn:({signal})=>(signal=>fetcher_fetcher({url:"/v1/user/cardnumber/friendly",method:"GET",signal}))(signal),...queryOptions}};function useGetV1UserCardnumberFriendly(options){const queryOptions=getGetV1UserCardnumberFriendlyQueryOptions(options),query=(0,es.useQuery)(queryOptions);return query.queryKey=queryOptions.queryKey,query}const getGetV1LibraryProfileQueryOptions=options=>{const{query:queryOptions}=options??{};return{queryKey:(null==queryOptions?void 0:queryOptions.queryKey)??["/v1/library/profile"],queryFn:({signal})=>(signal=>fetcher_fetcher({url:"/v1/library/profile",method:"GET",signal}))(signal),...queryOptions}};function useGetV1LibraryProfile(options){const queryOptions=getGetV1LibraryProfileQueryOptions(options),query=(0,es.useQuery)(queryOptions);return query.queryKey=queryOptions.queryKey,query}const getGetV1UserLoansQueryKey=params=>["/v1/user/loans",...params?[params]:[]],getGetV1UserLoansQueryOptions=(params,options)=>{const{query:queryOptions}=options??{};return{queryKey:(null==queryOptions?void 0:queryOptions.queryKey)??getGetV1UserLoansQueryKey(params),queryFn:({signal})=>((params,signal)=>fetcher_fetcher({url:"/v1/user/loans",method:"GET",params,signal}))(params,signal),...queryOptions}};function useGetV1UserLoans(params,options){const queryOptions=getGetV1UserLoansQueryOptions(params,options),query=(0,es.useQuery)(queryOptions);return query.queryKey=queryOptions.queryKey,query}const getPostV1UserLoansIdentifierMutationOptions=options=>{const{mutation:mutationOptions}=options??{};return{mutationFn:props=>{const{identifier,params}=props??{};return((identifier,params)=>fetcher_fetcher({url:`/v1/user/loans/${identifier}`,method:"POST",params}))(identifier,params)},...mutationOptions}},usePostV1UserLoansIdentifier=options=>{const mutationOptions=getPostV1UserLoansIdentifierMutationOptions(options);return(0,es.useMutation)(mutationOptions)},getGetV1LoanstatusIdentifierQueryKey=identifier=>[`/v1/loanstatus/${identifier}`],getGetV1LoanstatusIdentifierQueryOptions=(identifier,queryOptions)=>({queryKey:(null==queryOptions?void 0:queryOptions.queryKey)??getGetV1LoanstatusIdentifierQueryKey(identifier),queryFn:({signal})=>((identifier,signal)=>fetcher_fetcher({url:`/v1/loanstatus/${identifier}`,method:"GET",signal}))(identifier,signal),enabled:!!identifier,...queryOptions});function useGetV1LoanstatusIdentifier(identifier,queryOptions){const options=getGetV1LoanstatusIdentifierQueryOptions(identifier,queryOptions),query=(0,es.useQuery)(options);return query.queryKey=options.queryKey,query}const getGetV1ProductsIdentifierQueryOptions=(identifier,options)=>{const{query:queryOptions}=options??{},queryKey=(null==queryOptions?void 0:queryOptions.queryKey)??(identifier=>[`/v1/products/${identifier}`])(identifier);return{queryKey,queryFn:({signal})=>((identifier,signal)=>fetcher_fetcher({url:`/v1/products/${identifier}`,method:"GET",signal}))(identifier,signal),enabled:!!identifier,...queryOptions}};function useGetV1ProductsIdentifier(identifier,options){const queryOptions=getGetV1ProductsIdentifierQueryOptions(identifier,options),query=(0,es.useQuery)(queryOptions);return query.queryKey=queryOptions.queryKey,query}const getGetV1UserReservationsQueryKey=()=>["/v1/user/reservations"],getGetV1UserReservationsQueryOptions=options=>{const{query:queryOptions}=options??{};return{queryKey:(null==queryOptions?void 0:queryOptions.queryKey)??getGetV1UserReservationsQueryKey(),queryFn:({signal})=>(signal=>fetcher_fetcher({url:"/v1/user/reservations",method:"GET",signal}))(signal),...queryOptions}};function useGetV1UserReservations(options){const queryOptions=getGetV1UserReservationsQueryOptions(options),query=(0,es.useQuery)(queryOptions);return query.queryKey=queryOptions.queryKey,query}const getPostV1UserReservationsIdentifierMutationOptions=options=>{const{mutation:mutationOptions}=options??{};return{mutationFn:props=>{const{identifier,data}=props??{};return((identifier,reservationInput)=>fetcher_fetcher({url:`/v1/user/reservations/${identifier}`,method:"POST",headers:{"Content-Type":"application/json"},data:reservationInput}))(identifier,data)},...mutationOptions}},usePostV1UserReservationsIdentifier=options=>{const mutationOptions=getPostV1UserReservationsIdentifierMutationOptions(options);return(0,es.useMutation)(mutationOptions)},getDeleteV1UserReservationsIdentifierMutationOptions=options=>{const{mutation:mutationOptions}=options??{};return{mutationFn:props=>{const{identifier}=props??{};return(identifier=>fetcher_fetcher({url:`/v1/user/reservations/${identifier}`,method:"DELETE"}))(identifier)},...mutationOptions}},useDeleteV1UserReservationsIdentifier=options=>{const mutationOptions=getDeleteV1UserReservationsIdentifierMutationOptions(options);return(0,es.useMutation)(mutationOptions)}},"./src/core/utils/branches.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ay:()=>__WEBPACK_DEFAULT_EXPORT__,ov:()=>useGetBranches,z5:()=>excludeBlacklistedBranches});var _config__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/core/utils/config.tsx");const excludeBlacklistedBranches=(branches,blacklist)=>branches.filter((item=>!blacklist.includes(item.branchId))),cleanBranchesId=branches=>branches.map((branch=>{const matches=/-(\d*)/g.exec(branch.branchId);return matches?matches[1]:""})).filter((item=>item)),useGetBranches=key=>{const config=(0,_config__WEBPACK_IMPORTED_MODULE_0__.UK)(),branches=config("branchesConfig",{transformer:"jsonParse"}),blacklistBranches=config(key,{transformer:"stringToArray"});return excludeBlacklistedBranches(branches,blacklistBranches)},__WEBPACK_DEFAULT_EXPORT__=()=>{const branches=useGetBranches("blacklistedSearchBranchesConfig");return cleanBranchesId(branches)};try{cleanBranchesId.displayName="cleanBranchesId",cleanBranchesId.__docgenInfo={description:"",displayName:"cleanBranchesId",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/core/utils/branches.tsx#cleanBranchesId"]={docgenInfo:cleanBranchesId.__docgenInfo,name:"cleanBranchesId",path:"src/core/utils/branches.tsx#cleanBranchesId"})}catch(__react_docgen_typescript_loader_error){}try{useGetBranches.displayName="useGetBranches",useGetBranches.__docgenInfo={description:"",displayName:"useGetBranches",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/core/utils/branches.tsx#useGetBranches"]={docgenInfo:useGetBranches.__docgenInfo,name:"useGetBranches",path:"src/core/utils/branches.tsx#useGetBranches"})}catch(__react_docgen_typescript_loader_error){}},"./src/core/utils/helpers/usePatronData.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ix:()=>usePatronData,lX:()=>getBlockedStatus});var _fbs_fbs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/core/fbs/fbs.ts"),_types_BlockedTypes__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/core/utils/types/BlockedTypes.ts"),_user__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/core/utils/helpers/user.ts");const usePatronData=()=>(0,_fbs_fbs__WEBPACK_IMPORTED_MODULE_0__.wF)({enabled:!(0,_user__WEBPACK_IMPORTED_MODULE_2__.ok)()}),getBlockedStatus=patron=>{var _patron$blockStatus;return null!=patron&&patron.blockStatus&&(null==patron||null===(_patron$blockStatus=patron.blockStatus)||void 0===_patron$blockStatus?void 0:_patron$blockStatus.length)>0?patron.blockStatus[0].blockedReason:_types_BlockedTypes__WEBPACK_IMPORTED_MODULE_1__.A.unknown}},"./src/core/utils/modal.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__,X:()=>useModalButtonHandler});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react_redux__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-redux/dist/react-redux.mjs"),_danskernesdigitalebibliotek_dpl_design_system_build_icons_collection_CloseLarge_svg__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@danskernesdigitalebibliotek/dpl-design-system/build/icons/collection/CloseLarge.svg"),_danskernesdigitalebibliotek_dpl_design_system_build_icons_collection_CloseLarge_svg__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_danskernesdigitalebibliotek_dpl_design_system_build_icons_collection_CloseLarge_svg__WEBPACK_IMPORTED_MODULE_2__),clsx__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/clsx/dist/clsx.mjs"),focus_trap_react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/focus-trap-react/dist/focus-trap-react.js"),_modal_slice__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/core/modal.slice.ts"),_helpers_user__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/core/utils/helpers/user.ts"),_helpers_url__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/core/utils/helpers/url.ts"),_helpers_general__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./src/core/utils/helpers/general.ts");function Modal({modalId,closeModalAriaLabelText,children,screenReaderModalDescriptionText,classNames,isSlider,dataCy="modal",eventCallbacks}){const dispatch=(0,react_redux__WEBPACK_IMPORTED_MODULE_1__.wA)(),{modalIds}=(0,react_redux__WEBPACK_IMPORTED_MODULE_1__.d4)((s=>s.modal));if((0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{new URLSearchParams(window.location.search).getAll("modal").forEach((id=>{dispatch((0,_modal_slice__WEBPACK_IMPORTED_MODULE_5__.qf)({modalId:id}))}))}),[modalId,dispatch]),modalIds&&!modalIds.includes(modalId))return null;const close=()=>{null!=eventCallbacks&&eventCallbacks.close&&eventCallbacks.close(),dispatch((0,_modal_slice__WEBPACK_IMPORTED_MODULE_5__.Oo)({modalId}))},handleCloseKeyUp=e=>{(0,_helpers_general__WEBPACK_IMPORTED_MODULE_8__.GC)(e.key)&&close()};return react__WEBPACK_IMPORTED_MODULE_0__.createElement(focus_trap_react__WEBPACK_IMPORTED_MODULE_4__.FocusTrap,{focusTrapOptions:{fallbackFocus:"body"}},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement("button",{className:"modal-backdrop","aria-label":closeModalAriaLabelText,style:{zIndex:modalIds.indexOf(modalId)+400},onMouseUp:()=>{close()},onKeyUp:handleCloseKeyUp}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:(0,clsx__WEBPACK_IMPORTED_MODULE_3__.A)("modal",{"modal-show":modalIds.includes(modalId)},classNames),role:"dialog","aria-labelledby":`modal-${modalId}-description`,"data-cy":dataCy,style:{zIndex:modalIds.indexOf(modalId)+400+1}},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"modal__screen-reader-description",id:`modal-${modalId}-description`},screenReaderModalDescriptionText),react__WEBPACK_IMPORTED_MODULE_0__.createElement("button",{type:"button",className:"btn-ui modal-btn-close "+(isSlider?"":"modal-btn-close--offset"),style:{zIndex:modalIds.indexOf(modalId)+400},"aria-label":closeModalAriaLabelText,onMouseUp:()=>{close()},onKeyUp:handleCloseKeyUp,"data-cy":`modal-${modalId}-close-button`},react__WEBPACK_IMPORTED_MODULE_0__.createElement("img",{src:_danskernesdigitalebibliotek_dpl_design_system_build_icons_collection_CloseLarge_svg__WEBPACK_IMPORTED_MODULE_2___default(),alt:"",style:{pointerEvents:"none"}})),children)))}const useModalButtonHandler=()=>{const dispatch=(0,react_redux__WEBPACK_IMPORTED_MODULE_1__.wA)(),{modalIds}=(0,react_redux__WEBPACK_IMPORTED_MODULE_1__.d4)((s=>s.modal)),closeModals=modalsToClose=>{modalsToClose.forEach((id=>{modalIds.includes(id)&&dispatch((0,_modal_slice__WEBPACK_IMPORTED_MODULE_5__.Oo)({modalId:id}))}))};return{open:(modalId,options)=>(null!=options&&options.modalsToClose&&closeModals(options.modalsToClose),dispatch((0,_modal_slice__WEBPACK_IMPORTED_MODULE_5__.qf)({modalId,updateUrl:null==options?void 0:options.updateUrl}))),close:modalId=>dispatch((0,_modal_slice__WEBPACK_IMPORTED_MODULE_5__.Oo)({modalId})),closeAll:()=>dispatch((0,_modal_slice__WEBPACK_IMPORTED_MODULE_5__.s7)()),openGuarded:({authUrl,modalId,trackOnlineView,options})=>{if((0,_helpers_user__WEBPACK_IMPORTED_MODULE_6__.ok)()){const returnUrl=(0,_helpers_url__WEBPACK_IMPORTED_MODULE_7__.gG)({modal:modalId});(0,_helpers_url__WEBPACK_IMPORTED_MODULE_7__.bX)({authUrl,returnUrl,trackingFunction:trackOnlineView})}else null!=options&&options.modalsToClose&&closeModals(options.modalsToClose),trackOnlineView&&trackOnlineView(),dispatch((0,_modal_slice__WEBPACK_IMPORTED_MODULE_5__.qf)({modalId,updateUrl:null==options?void 0:options.updateUrl}))}}},__WEBPACK_DEFAULT_EXPORT__=Modal;try{Modal.displayName="Modal",Modal.__docgenInfo={description:"",displayName:"Modal",props:{modalId:{defaultValue:null,description:"",name:"modalId",required:!0,type:{name:"string"}},closeModalAriaLabelText:{defaultValue:null,description:"",name:"closeModalAriaLabelText",required:!0,type:{name:"string"}},screenReaderModalDescriptionText:{defaultValue:null,description:"",name:"screenReaderModalDescriptionText",required:!0,type:{name:"string"}},classNames:{defaultValue:null,description:"",name:"classNames",required:!1,type:{name:"string | undefined"}},dataCy:{defaultValue:{value:"modal"},description:"",name:"dataCy",required:!1,type:{name:"string | undefined"}},isSlider:{defaultValue:null,description:"",name:"isSlider",required:!1,type:{name:"boolean | undefined"}},eventCallbacks:{defaultValue:null,description:"",name:"eventCallbacks",required:!1,type:{name:"{ close?: (() => void) | undefined; } | undefined"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/core/utils/modal.tsx#Modal"]={docgenInfo:Modal.__docgenInfo,name:"Modal",path:"src/core/utils/modal.tsx#Modal"})}catch(__react_docgen_typescript_loader_error){}},"./src/core/utils/types/BlockedTypes.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var BlockedTypes=function(BlockedTypes){return BlockedTypes.extendedSuspension="F",BlockedTypes.deceased="D",BlockedTypes.fee="E",BlockedTypes.missingPatronCategory="W",BlockedTypes.accountStolen="O",BlockedTypes.suspension="U",BlockedTypes.blockedFromSelfservice="S",BlockedTypes.unknown="unknown",BlockedTypes}(BlockedTypes||{});const __WEBPACK_DEFAULT_EXPORT__=BlockedTypes}}]);